Demonstrations of tcpcongestdura, the Linux eBPF/bcc version.

This tool traces linux kernel's tcp congestion control status change functions,
then calculate duration of every status and record it, at last prints it as 
tables or histogram, which can be used for evaluating the tcp congestion 
algorithm's performance.

For example:

./tcpcong 
Tracing tcp congestion control status duration... Hit Ctrl-C to end.
^C
LAddrPort            RAddrPort             Open_ms Dod_ms Rcov_ms Cwr_ms  Los_ms Chgs 
192.168.219.3/33914   192.168.219.2/19226   768     6      62      553     0      7658 
192.168.219.3/33918   192.168.219.2/19226   789     5      55      539     0      8456 
192.168.219.3/33930   192.168.219.2/19226   798     6      46      539     0      9049 
192.168.219.3/33940   192.168.219.2/19226   687     0      0       703     0      8044 
192.168.219.3/38210   192.168.219.4/19228   805     9      62      511     0      5527 
192.168.219.3/38228   192.168.219.4/19228   701     2      15      672     0      7939 
192.168.219.3/38234   192.168.219.4/19228   847     12     57      470     0      7443 
192.168.219.3/38236   192.168.219.4/19228   741     2      15      632     0      8639 
192.168.219.3/43602   192.168.219.1/19226   801     15     109     448     0      7336 
192.168.219.3/43618   192.168.219.1/19226   610     14     486     280     0      5007 
192.168.219.3/43624   192.168.219.1/19226   741     0      8       639     0      9390 
192.168.219.3/43626   192.168.219.1/19226   1210    21     93      68      0      2724 
192.168.219.3/45444   192.168.219.1/19227   851     17     96      426     0      7711 
192.168.219.3/45460   192.168.219.1/19227   850     16     103     420     0      7478 
192.168.219.3/45476   192.168.219.1/19227   706     16     301     367     0      5964 
192.168.219.3/45490   192.168.219.1/19227   731     1      8       648     0      8847 
192.168.219.3/45914   192.168.219.1/19225   717     1      13      658     0      8680 
192.168.219.3/45922   192.168.219.1/19225   708     1      8       673     0      8231 
192.168.219.3/45938   192.168.219.1/19225   755     1      10      623     0      9343 
192.168.219.3/45952   192.168.219.1/19225   705     15     87      583     0      6114 
192.168.219.3/46356   192.168.219.4/19230   857     10     66      456     0      7670 
192.168.219.3/46370   192.168.219.4/19230   726     2      17      644     0      8073 
192.168.219.3/46378   192.168.219.4/19230   689     2      16      683     0      8039 
192.168.219.3/46380   192.168.219.4/19230   867     7      67      447     0      7500 
192.168.219.3/51156   192.168.219.2/19227   661     4      249     475     0      7464 
192.168.219.3/51166   192.168.219.2/19227   680     0      0       709     0      8575 
192.168.219.3/51174   192.168.219.2/19227   688     0      0       702     0      8005 
192.168.219.3/51182   192.168.219.2/19227   655     0      0       736     0      6947 
192.168.219.3/58350   192.168.219.2/19225   805     6      45      531     0      8949 
192.168.219.3/58354   192.168.219.2/19225   723     5      45      618     0      6177 
192.168.219.3/58360   192.168.219.2/19225   661     0      1       729     0      7858 
192.168.219.3/58370   192.168.219.2/19225   1392    0      0       0       0      1463 
192.168.219.3/60028   192.168.219.4/19229   827     11     65      483     0      7265 
192.168.219.3/60042   192.168.219.4/19229   735     3      14      638     0      5723 
192.168.219.3/60046   192.168.219.4/19229   662     3      21      704     0      7138 
192.168.219.3/60064   192.168.219.4/19229   811     8      71      496     0      7556 

The example shows all tcp socket's congestion status duration for milliseconds,
open_ms column is the duration of tcp connection in open status whose cwnd can
increase; dod_ms column is the duration of tcp connection in disorder status 
who receives disordered packet; rcov_ms column is the duration of tcp 
connection in recovery status who receives 3 duplicated acks; cwr_ms column 
is the duration of tcp connection who receives explicitly congest notifier and
two acks to reduce the cwnd. the last column chgs prints total status change 
number of the socket.

An interval can be provided, and also optionally a count. Eg, printing output
every 1 second, and including timestamps (-T):
./tcpcong -T 1 2
Tracing tcp congestion control status duration... Hit Ctrl-C to end.

03:32:42
LAddrPort            RAddrPort             Open_ms Dod_ms Rcov_ms Cwr_ms  Los_ms Chgs 
192.168.219.3/33914   192.168.219.2/19226   633     2      30      486     0      6659 
192.168.219.3/33918   192.168.219.2/19226   635     3      30      483     0      7093 
192.168.219.3/33930   192.168.219.2/19226   638     4      36      470     0      7417 
192.168.219.3/33940   192.168.219.2/19226   586     0      0       566     0      7170 
192.168.219.3/38210   192.168.219.4/19228   689     8      59      396     0      5087 
192.168.219.3/38228   192.168.219.4/19228   575     2      23      553     0      6572 
192.168.219.3/38234   192.168.219.4/19228   716     10     57      368     0      6003 
192.168.219.3/38236   192.168.219.4/19228   613     2      16      520     0      7159 
192.168.219.3/43602   192.168.219.1/19226   565     9      271     303     0      4879 
192.168.219.3/43618   192.168.219.1/19226   564     13     60      514     0      4626 
192.168.219.3/43624   192.168.219.1/19226   602     0      5       543     0      7471 
192.168.219.3/43626   192.168.219.1/19226   1011    15     79      47      0      2294 
192.168.219.3/45444   192.168.219.1/19227   702     11     95      343     0      6251 
192.168.219.3/45460   192.168.219.1/19227   699     11     83      358     0      6142 
192.168.219.3/45476   192.168.219.1/19227   717     11     76      345     0      5899 
192.168.219.3/45490   192.168.219.1/19227   617     1      8       526     0      4415 
192.168.219.3/45914   192.168.219.1/19225   600     1      5       545     0      7158 
192.168.219.3/45922   192.168.219.1/19225   593     0      5       554     0      6735 
192.168.219.3/45938   192.168.219.1/19225   617     1      7       525     0      7411 
192.168.219.3/45952   192.168.219.1/19225   674     13     94      371     0      5462 
192.168.219.3/46356   192.168.219.4/19230   724     7      62      359     0      6250 
192.168.219.3/46370   192.168.219.4/19230   610     2      16      523     0      6632 
192.168.219.3/46378   192.168.219.4/19230   584     3      20      546     0      6749 
192.168.219.3/46380   192.168.219.4/19230   726     7      60      359     0      6165 
192.168.219.3/51156   192.168.219.2/19227   621     1      25      505     0      4437 
192.168.219.3/51166   192.168.219.2/19227   579     0      0       574     0      4799 
192.168.219.3/51174   192.168.219.2/19227   584     0      0       567     0      7309 
192.168.219.3/51182   192.168.219.2/19227   545     0      0       607     0      6062 
192.168.219.3/58350   192.168.219.2/19225   651     5      30      462     0      7384 
192.168.219.3/58354   192.168.219.2/19225   491     4      28      629     2      2573 
192.168.219.3/58360   192.168.219.2/19225   575     0      0       578     0      4244 
192.168.219.3/58370   192.168.219.2/19225   1154    0      0       0       0      1269 
192.168.219.3/60028   192.168.219.4/19229   708     10     60      373     0      6028 
192.168.219.3/60042   192.168.219.4/19229   613     2      16      519     0      7049 
192.168.219.3/60046   192.168.219.4/19229   531     3      18      601     0      5406 
192.168.219.3/60064   192.168.219.4/19229   716     7      61      368     0      6205 

03:32:43
LAddrPort            RAddrPort             Open_ms Dod_ms Rcov_ms Cwr_ms  Los_ms Chgs 
192.168.219.3/33914   192.168.219.2/19226   559     2      24      411     0      5655 
192.168.219.3/33918   192.168.219.2/19226   493     2      29      340     0      4837 
192.168.219.3/33930   192.168.219.2/19226   575     1      19      401     0      6154 
192.168.219.3/33940   192.168.219.2/19226   511     0      0       486     0      6445 
192.168.219.3/38210   192.168.219.4/19228   582     10     69      336     0      3906 
192.168.219.3/38228   192.168.219.4/19228   492     2      16      486     0      6048 
192.168.219.3/38234   192.168.219.4/19228   645     11     65      273     0      5138 
192.168.219.3/38236   192.168.219.4/19228   514     2      27      452     0      6177 
192.168.219.3/43602   192.168.219.1/19226   598     9      60      328     0      5112 
192.168.219.3/43618   192.168.219.1/19226   619     15     63      293     0      5276 
192.168.219.3/43624   192.168.219.1/19226   530     0      5       460     0      6743 
192.168.219.3/43626   192.168.219.1/19226   871     17     70      39      0      1906 
192.168.219.3/45444   192.168.219.1/19227   466     8      54      417     0      4062 
192.168.219.3/45460   192.168.219.1/19227   615     8      77      295     0      5158 
192.168.219.3/45476   192.168.219.1/19227   607     10     66      312     0      5161 
192.168.219.3/45490   192.168.219.1/19227   551     0      1       445     0      3778 
192.168.219.3/45914   192.168.219.1/19225   512     0      4       480     0      6173 
192.168.219.3/45922   192.168.219.1/19225   518     0      3       475     0      5739 
192.168.219.3/45938   192.168.219.1/19225   553     0      3       440     0      6559 
192.168.219.3/45952   192.168.219.1/19225   168     2      227     99      0      1336 
192.168.219.3/46356   192.168.219.4/19230   634     8      67      288     0      4952 
192.168.219.3/46370   192.168.219.4/19230   525     3      21      447     0      5653 
192.168.219.3/46378   192.168.219.4/19230   504     2      14      477     0      6092 
192.168.219.3/46380   192.168.219.4/19230   545     6      48      230     0      4293 
192.168.219.3/51156   192.168.219.2/19227   574     0      18      404     0      3521 
192.168.219.3/51166   192.168.219.2/19227   497     0      0       500     0      4211 
192.168.219.3/51174   192.168.219.2/19227   503     0      0       494     0      6405 
192.168.219.3/51182   192.168.219.2/19227   482     0      0       515     0      5457 
192.168.219.3/58350   192.168.219.2/19225   587     2      25      381     0      6138 
192.168.219.3/58354   192.168.219.2/19225   539     1      21      436     0      2697 
192.168.219.3/58360   192.168.219.2/19225   487     0      0       511     0      3810 
192.168.219.3/58370   192.168.219.2/19225   1000    0      0       0       0      1107 
192.168.219.3/60028   192.168.219.4/19229   637     11     71      271     0      5170 
192.168.219.3/60042   192.168.219.4/19229   534     3      23      435     0      5601 
192.168.219.3/60046   192.168.219.4/19229   489     3      21      484     0      5191 
192.168.219.3/60064   192.168.219.4/19229   652     11     73      260     0      5368 


An local port and remote port can be specified, and also optionally a count.
Eg printing output every 1 second, and including timestamps (-T) for local
ports 30000-40000 and remote ports 19225-19227:
./tcpcong -T -L 30000-40000 -R 19225-19227 1 3    
Tracing tcp congestion control status duration... Hit Ctrl-C to end.

03:34:25
LAddrPort            RAddrPort             Open_ms Dod_ms Rcov_ms Cwr_ms  Los_ms Chgs 
192.168.219.3/33914   192.168.219.2/19226   654     4      46      450     0      6217 
192.168.219.3/33918   192.168.219.2/19226   669     3      39      443     0      6657 
192.168.219.3/33930   192.168.219.2/19226   672     3      32      447     0      7056 
192.168.219.3/33940   192.168.219.2/19226   577     0      0       579     0      7113 

03:34:26
LAddrPort            RAddrPort             Open_ms Dod_ms Rcov_ms Cwr_ms  Los_ms Chgs 
192.168.219.3/33914   192.168.219.2/19226   555     4      38      399     0      5295 
192.168.219.3/33918   192.168.219.2/19226   571     5      50      371     0      5629 
192.168.219.3/33930   192.168.219.2/19226   576     4      36      380     0      5934 
192.168.219.3/33940   192.168.219.2/19226   496     0      0       501     0      6006 

03:34:27
LAddrPort            RAddrPort             Open_ms Dod_ms Rcov_ms Cwr_ms  Los_ms Chgs 
192.168.219.3/33914   192.168.219.2/19226   561     4      32      399     0      5603 
192.168.219.3/33918   192.168.219.2/19226   591     3      37      365     0      5727 
192.168.219.3/33930   192.168.219.2/19226   584     3      31      379     0      5991 
192.168.219.3/33940   192.168.219.2/19226   487     0      1       508     0      5999 


The (-u) option can be specified for recording the duration as miroseconds.
Eg printing output every 1 second, and including timestamps (-T) and 
microseconds (-u) for local ports 30000-40000 and remote ports 19225-19227:
./tcpcong -T -u -L 30000-40000 -R 19225-19227 1 3 
Tracing tcp congestion control status duration... Hit Ctrl-C to end.

03:34:53
LAddrPort            RAddrPort             Open_us Dod_us Rcov_us Cwr_us  Los_us Chgs 
192.168.219.3/33914   192.168.219.2/19226   621599  6419   55233   358444  0      5428 
192.168.219.3/33918   192.168.219.2/19226   580953  7410   55007   520936  778    5329 
192.168.219.3/33930   192.168.219.2/19226   701884  6742   70847   384943  0      6698 
192.168.219.3/33940   192.168.219.2/19226   582251  187    299     582195  0      6958 

03:34:54
LAddrPort            RAddrPort             Open_us Dod_us Rcov_us Cwr_us  Los_us Chgs 
192.168.219.3/33914   192.168.219.2/19226   507546  3127   35685   366030  419    4823 
192.168.219.3/33918   192.168.219.2/19226   556039  4007   34501   402823  0      5960 
192.168.219.3/33930   192.168.219.2/19226   566019  3178   32111   395975  0      6292 
192.168.219.3/33940   192.168.219.2/19226   486719  25     805     510134  0      5839 

03:34:55
LAddrPort            RAddrPort             Open_us Dod_us Rcov_us Cwr_us  Los_us Chgs 
192.168.219.3/33914   192.168.219.2/19226   575140  4887   38610   377699  0      5386 
192.168.219.3/33918   192.168.219.2/19226   583658  4939   46328   362096  0      5896 
192.168.219.3/33930   192.168.219.2/19226   460059  3588   244015  290590  245    4784 
192.168.219.3/33940   192.168.219.2/19226   492500  0      723     504760  0      5903 


The distribution of congestion status duration can be printed as a histogram 
with the -d option and also optionally a count. Eg printing output every 
1 second for microseconds, and including timestamps (-T):
./tcpcong.py -d -u -T 1 2
Tracing tcp congestion control status duration... Hit Ctrl-C to end.

03:35:23

tcp_congest_state = open
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 29       |                                        |
         4 -> 7          : 163      |                                        |
         8 -> 15         : 213      |                                        |
        16 -> 31         : 225      |                                        |
        32 -> 63         : 363      |*                                       |
        64 -> 127        : 699      |**                                      |
       128 -> 255        : 3687     |***********                             |
       256 -> 511        : 12327    |****************************************|
       512 -> 1023       : 12028    |*************************************** |
      1024 -> 2047       : 3976     |************                            |
      2048 -> 4095       : 1004     |***                                     |
      4096 -> 8191       : 162      |                                        |
      8192 -> 16383      : 27       |                                        |
     16384 -> 32767      : 9        |                                        |
     32768 -> 65535      : 2        |                                        |

tcp_congest_state = disorder
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 6        |                                        |
         4 -> 7          : 25       |*                                       |
         8 -> 15         : 42       |**                                      |
        16 -> 31         : 86       |*****                                   |
        32 -> 63         : 273      |****************                        |
        64 -> 127        : 671      |****************************************|
       128 -> 255        : 459      |***************************             |
       256 -> 511        : 75       |****                                    |
       512 -> 1023       : 6        |                                        |

tcp_congest_state = cwr
     usecs               : count     distribution
         0 -> 1          : 21       |                                        |
         2 -> 3          : 5351     |***                                     |
         4 -> 7          : 7728     |*****                                   |
         8 -> 15         : 5769     |****                                    |
        16 -> 31         : 13212    |*********                               |
        32 -> 63         : 29931    |*********************                   |
        64 -> 127        : 56757    |****************************************|
       128 -> 255        : 34704    |************************                |
       256 -> 511        : 6971     |****                                    |
       512 -> 1023       : 425      |                                        |
      1024 -> 2047       : 21       |                                        |
      2048 -> 4095       : 0        |                                        |
      4096 -> 8191       : 2        |                                        |
      8192 -> 16383      : 2        |                                        |
     16384 -> 32767      : 0        |                                        |
     32768 -> 65535      : 4        |                                        |
     65536 -> 131071     : 0        |                                        |
    131072 -> 262143     : 1        |                                        |

tcp_congest_state = recovery
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 222      |*                                       |
         4 -> 7          : 1630     |**********                              |
         8 -> 15         : 1329     |********                                |
        16 -> 31         : 2699     |*****************                       |
        32 -> 63         : 6049     |****************************************|
        64 -> 127        : 4385     |****************************            |
       128 -> 255        : 2116     |*************                           |
       256 -> 511        : 303      |**                                      |
       512 -> 1023       : 23       |                                        |
      1024 -> 2047       : 4        |                                        |
      2048 -> 4095       : 1        |                                        |
      4096 -> 8191       : 3        |                                        |
      8192 -> 16383      : 2        |                                        |
     16384 -> 32767      : 0        |                                        |
     32768 -> 65535      : 0        |                                        |
     65536 -> 131071     : 0        |                                        |
    131072 -> 262143     : 1        |                                        |

tcp_congest_state = loss
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 0        |                                        |
         4 -> 7          : 0        |                                        |
         8 -> 15         : 0        |                                        |
        16 -> 31         : 0        |                                        |
        32 -> 63         : 0        |                                        |
        64 -> 127        : 0        |                                        |
       128 -> 255        : 5        |****************************************|
       256 -> 511        : 3        |************************                |

03:35:24

tcp_congest_state = disorder
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 3        |                                        |
         4 -> 7          : 28       |*                                       |
         8 -> 15         : 53       |***                                     |
        16 -> 31         : 74       |****                                    |
        32 -> 63         : 259      |****************                        |
        64 -> 127        : 641      |****************************************|
       128 -> 255        : 423      |**************************              |
       256 -> 511        : 99       |******                                  |
       512 -> 1023       : 5        |                                        |

tcp_congest_state = open
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 13       |                                        |
         4 -> 7          : 194      |                                        |
         8 -> 15         : 213      |                                        |
        16 -> 31         : 173      |                                        |
        32 -> 63         : 339      |*                                       |
        64 -> 127        : 565      |*                                       |
       128 -> 255        : 3433     |************                            |
       256 -> 511        : 11358    |****************************************|
       512 -> 1023       : 11172    |*************************************** |
      1024 -> 2047       : 3555     |************                            |
      2048 -> 4095       : 956      |***                                     |
      4096 -> 8191       : 142      |                                        |
      8192 -> 16383      : 11       |                                        |
     16384 -> 32767      : 0        |                                        |
     32768 -> 65535      : 1        |                                        |

tcp_congest_state = cwr
     usecs               : count     distribution
         0 -> 1          : 19       |                                        |
         2 -> 3          : 5386     |****                                    |
         4 -> 7          : 7695     |******                                  |
         8 -> 15         : 5571     |****                                    |
        16 -> 31         : 11959    |*********                               |
        32 -> 63         : 26514    |********************                    |
        64 -> 127        : 51018    |****************************************|
       128 -> 255        : 32838    |*************************               |
       256 -> 511        : 6947     |*****                                   |
       512 -> 1023       : 370      |                                        |
      1024 -> 2047       : 5        |                                        |
      2048 -> 4095       : 0        |                                        |
      4096 -> 8191       : 8        |                                        |
      8192 -> 16383      : 1        |                                        |
     16384 -> 32767      : 0        |                                        |
     32768 -> 65535      : 1        |                                        |
     65536 -> 131071     : 0        |                                        |
    131072 -> 262143     : 1        |                                        |

tcp_congest_state = recovery
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 227      |*                                       |
         4 -> 7          : 1586     |***********                             |
         8 -> 15         : 1237     |********                                |
        16 -> 31         : 2643     |******************                      |
        32 -> 63         : 5651     |****************************************|
        64 -> 127        : 4270     |******************************          |
       128 -> 255        : 2053     |**************                          |
       256 -> 511        : 272      |*                                       |
       512 -> 1023       : 42       |                                        |
      1024 -> 2047       : 0        |                                        |
      2048 -> 4095       : 0        |                                        |
      4096 -> 8191       : 3        |                                        |
      8192 -> 16383      : 1        |                                        |

tcp_congest_state = loss
     usecs               : count     distribution
         0 -> 1          : 0        |                                        |
         2 -> 3          : 0        |                                        |
         4 -> 7          : 0        |                                        |
         8 -> 15         : 0        |                                        |
        16 -> 31         : 0        |                                        |
        32 -> 63         : 0        |                                        |
        64 -> 127        : 2        |****************************************|
       128 -> 255        : 2        |****************************************|
       256 -> 511        : 1        |********************                    |



USAGE:
./tcpcong -h
usage: tcpcong [-h] [-L LOCALPORT] [-R REMOTEPORT] [-T] [-d] [-u]
                  [interval] [outputs]

Summarize tcp socket congestion control status duration

positional arguments:
  interval              output interval, in seconds
  outputs               number of outputs

optional arguments:
  -h, --help            show this help message and exit
  -L LOCALPORT, --localport LOCALPORT
                        trace local ports only
  -R REMOTEPORT, --remoteport REMOTEPORT
                        trace the dest ports only
  -T, --timestamp       include timestamp on output
  -d, --dist            show distributions as histograms
  -u, --microseconds    output in microseconds

examples:
    ./tcpcong                 #show tcp congestion status duration
    ./tcpcong 1 10            #show 1 second summaries, 10 times
    ./tcpcong -L 3000-3006 1  #1s summaries, local port 3000-3006
    ./tcpcong -R 5000-5005 1  #1s summaries, remote port 5000-5005
    ./tcpcong -uT 1           #1s summaries, microseconds, and timestamps
    ./tcpcong -d              #show the duration as histograms
